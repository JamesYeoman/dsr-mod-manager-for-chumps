var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))P.call(t,n)&&D(e,n,t[n]);if(N)for(var n of N(t))E.call(t,n)&&D(e,n,t[n]);return e},b=(e,t)=>Z(e,ee(t));var M=(e,t)=>{var n={};for(var o in e)P.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&N)for(var o of N(e))t.indexOf(o)<0&&E.call(e,o)&&(n[o]=e[o]);return n};import{c as V,a as p,r as k,u as te,b as ne,d as w,j as a,e as m,f as h,R as q,T as ae,l as O,P as oe,D as se,C as ie,g as re,h as le,i as ce}from"./vendor.875c5ecf.js";const de=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};de();const g="__TAURI_IPC__"in window,me=e=>"message"in e?typeof e.message=="string":!1,K=e=>me(e)?new Error(e.message):new Error(`The following unknown object was caught: ${JSON.stringify(e)}`),C=e=>{const t=K(e);console.error({err:t}),alert(`${t}`)},ue=(e,t)=>({key:`${t}/${e}`,label:e}),fe=(e,t)=>{if(e.length===0)throw new Error("Accumulator should not be empty");return[...e,ue(t,e[e.length-1].key)]},he=(e,t)=>e.split("/").reduce(fe,t),pe=(e,t)=>{const n={key:t,label:t,nodes:[]},i=e.map(r=>`${r.path}/${r.filename}`).map(r=>he(r,[n])).flat().reduce((r,l)=>{const c=[...r];return l.key===n.key||r.some(f=>l.key===f.key)||c.push(l),c},[]),u=[d({},n)];return i.forEach(r=>{const l=d({},r),c=l.key.slice(0,l.key.lastIndexOf("/")),f=u.find(_=>c===_.key);if(!f)throw"This shouldn't happen! The unflattening method is broken!";f.nodes||(f.nodes=[]),f.nodes.push(l),u.push(l)}),n.nodes?n.nodes:[]},ge=(e,t,n)=>{const o=Array.from(e),[s]=o.splice(t,1);return o.splice(n,0,s),o};function be(e,t){return e.isDropAnimating?b(d({},t),{transitionDuration:"0.1s"}):t}const ye=[{content:"Better Rolling",id:"better_rolling-0.2.0"},{content:"This is a dummy mod",id:"mod-0"},{content:"This is another dummy mod",id:"mod-1"},{content:"This is a third, selected dummy mod",id:"mod-2"},{content:"This is a forth dummy mod",id:"mod-3"}],A={["better_rolling-0.2.0"]:[{path:"Model/chr/c0000/hkxx64",filename:"mock_file_01.hkx"},{path:"Model/chr/c0000/hkxx64",filename:"mock_file_02.hkx"},{path:"Model/chr/c0000/hkxx64",filename:"mock_file_03.hkx"},{path:"Model/chr/c0000/taeNew/x64",filename:"a00.tae"},{path:"Model/chr/c0000/taeNew/x64",filename:"a01.tae"}],["mod-0"]:[{path:"foo",filename:"bar"},{path:"foo",filename:"baz"}],["mod-1"]:[{path:"a/b",filename:"c"},{path:"a/ab",filename:"abc"}],["mod-2"]:[{path:"I/like",filename:"Pizza"},{path:"I/like",filename:"Fish and Chips"},{path:"I/like",filename:"Chocolate"}],["mod-3"]:[{path:"a/a/a/a/a",filename:"a"},{path:"a/a/a/a/b",filename:"b"},{path:"a/a/a/b/a",filename:"a"},{path:"a/a/a/b/b",filename:"b"},{path:"a/a/b/a/a",filename:"a"},{path:"a/a/b/a/b",filename:"b"},{path:"a/a/b/b/a",filename:"a"},{path:"a/a/b/b/b",filename:"b"},{path:"b/a/a/a/a",filename:"a"},{path:"b/a/a/a/b",filename:"b"},{path:"b/a/a/b/a",filename:"a"},{path:"b/a/a/b/b",filename:"b"},{path:"b/a/b/a/a",filename:"a"},{path:"b/a/b/a/b",filename:"b"},{path:"b/a/b/b/a",filename:"a"},{path:"b/a/b/b/b",filename:"b"}]},ke={list:[],loading:!1,fileList:[{key:"root",label:"No mod is selected"}]},we=V({name:"mods",initialState:ke,reducers:{setSelected:(e,t)=>{e.selected=t.payload},setList:(e,t)=>{e.list=t.payload},setLoading:(e,t)=>{e.loading=t.payload},setLoadErr:(e,t)=>{e.loadErr=t.payload},setFileInfo:(e,t)=>{e.fileList=t.payload}}}),{actions:I,reducer:ve}=we,{setFileInfo:_e}=I,{setList:U,setLoading:$,setLoadErr:Ne}=I,W=p("mods/refreshModList",async(e,{dispatch:t,getState:n})=>{if(!n().mods.loading){t($(!0));try{const o=g?await k("get_mod_list"):ye;t(U(o))}catch(o){const s=K(o);t(Ne(s))}finally{t($(!1))}}}),xe=async e=>e?g?await k("get_file_list",{id:e}):Object.keys(A).some(t=>t===e)?A[e]:[{path:"root",filename:`No mock data was found for ${e}`}]:[{path:"root",filename:"No mod is selected"}],Le=p("mods/_getFileList",async(e,{dispatch:t,getState:n})=>{const{selected:o}=n().mods,s=await xe(o),i=pe(s,o||"root");t(_e(i))}),Ce=p("mods/selectMod",async(e,{dispatch:t,getState:n})=>{const{selected:o}=n().mods;e!==o&&(t(I.setSelected(e)),await t(Le()))}),Te=p("mods/handleDropCard",async({source:e,destination:t},{dispatch:n,getState:o})=>{if(!t)return;const s=ge(o().mods.list,e.index,t.index);n(U(s))}),T=()=>te(),y=ne,R=g?"":"Unavailable. Not running in tauri",Me={gameLocation:{old:R,new:""},modsLocation:{old:R,new:""},isRunningTauriCmd:!1},Ie=V({name:"settings",initialState:Me,reducers:{setGameFolder:(e,t)=>{e.gameLocation.old=t.payload},setNewGameFolder:(e,t)=>{e.gameLocation.new=t.payload},setNewModsFolder:(e,t)=>{e.modsLocation.new=t.payload},setModsFolder:(e,t)=>{e.modsLocation.old=t.payload},toggleIsRunningTauriCmd:e=>{e.isRunningTauriCmd=!e.isRunningTauriCmd}}}),{actions:J,reducer:Se}=Ie,{setNewGameFolder:S,toggleIsRunningTauriCmd:L,setNewModsFolder:F}=J,{setModsFolder:Fe,setGameFolder:De}=J,Pe=p("settings/pickGameLocation",async(e,{dispatch:t})=>{if(!!g){t(L());try{const n=await k("request_game_location");t(S(n))}catch(n){C(n)}finally{t(L())}}}),Ee=p("settings/pickModsLocation",async(e,{dispatch:t})=>{if(!!g){t(L());try{const n=await k("request_mods_location");t(F(n))}catch(n){C(n)}finally{t(L())}}}),j=p("settings/cancel",async(e,{dispatch:t,getState:n})=>{const{gameLocation:o,modsLocation:s}=n().settings;try{g&&await k("discard_settings"),o.new.length>0&&t(S("")),s.new.length>0&&t(F(""))}catch(i){C(i)}}),B=p("settings/save",async(e,{dispatch:t,getState:n})=>{const{gameLocation:o,modsLocation:s}=n().settings;try{g&&await k("save_settings"),o.new.length>0&&(t(De(o.new)),t(S(""))),s.new.length>0&&(t(Fe(s.new)),t(F("")))}catch(i){C(i)}}),Q=e=>{const{className:t,x:n,y:o,children:s}=e,i={xmlns:"http://www.w3.org/2000/svg",version:"1.1",x:"0px",y:"0px",viewBox:`0 0 ${n} ${o}`,className:w("fill-base-content max-h-full max-w-full w-full min-w-full",t==null?void 0:t.trim()),role:"img"};return a("svg",b(d({},i),{children:s}))},Oe=({styling:e})=>m(Q,{className:e,x:240,y:240,children:[a("desc",{children:"Click me to open up a folder picker dialog!"}),a("path",{d:"M226 76 H14 V23 h71 l8 19 h133 V76 z"}),a("path",{d:"M5 217 h230 L240 89 H0 L5 217 z"})]}),H=({label:e,value:t,onBrowse:n})=>m("div",{className:"input-container",children:[a("div",{className:"input-container__label cell-card",children:e}),a("div",{className:"input-container__value cell-card",children:t}),a("button",{className:"input-container__browse",onClick:n,children:a(Oe,{})})]}),x=({text:e,onClickHandler:t})=>a("button",{className:"btn btn-primary",tabIndex:0,onClick:t,children:e}),Ae=({onAccept:e,onReject:t})=>m("div",{className:"modal__action",children:[a("button",{className:"btn-accept",onClick:e,children:"Save"}),a("button",{className:"btn-reject",onClick:t,children:"Cancel"})]}),$e=({onClose:e})=>a("div",{className:"modal-action justify-center",children:a("button",{className:"btn-close",onClick:e,children:"Close"})}),Re=({actionProps:e})=>"onAccept"in e?a(Ae,d({},e)):a($e,d({},e)),je=({children:e,isOpen:t,title:n,actionProps:o})=>a("div",{className:w("modal",{"modal-open":t}),children:m("div",{className:"modal__content",children:[m("div",{children:[a("h1",{className:"modal-title",children:n}),a("div",{className:"divider"}),e]}),m("div",{children:[a("div",{className:"divider"}),a(Re,{actionProps:o})]})]})}),G=e=>e.new.length>0?e.new:e.old,Be=()=>{const[e,t]=h.exports.useState(!1),n=T(),o=y(c=>c.settings.gameLocation),s=y(c=>c.settings.modsLocation),i=h.exports.useCallback(()=>{t(!1),n(B())},[t,n,B]),u=h.exports.useCallback(()=>{t(!1),n(j())},[t,n,j]),r={onAccept:i,onReject:u},l="Settings";return m(q.Fragment,{children:[a(x,{text:"settings",onClickHandler:()=>t(!0)}),m(je,{isOpen:e,title:l,actionProps:r,children:[a(H,{label:"Game folder",value:G(o),onBrowse:()=>n(Pe())}),a(H,{label:"Mods folder",value:G(s),onBrowse:()=>n(Ee())})]})]})},z=e=>()=>{console.log(`${e} button clicked!`)},He=()=>{const e=T();return a("div",{className:"action-buttons__container",children:m("div",{className:"action-buttons__grid",children:[a(Be,{}),a(x,{text:"refresh",onClickHandler:()=>e(W())}),a(x,{text:"inject",onClickHandler:z("Inject")}),a(x,{text:"play",onClickHandler:z("Play")})]})})},Ge=({classname:e})=>m(Q,{className:e,x:120,y:120,children:[a("polygon",{points:"21 23 79 79 99 60 41 3",strokeWidth:"1"}),a("polygon",{points:"21 97 41 117 99 60 79 41",strokeWidth:"1"})]}),ze=({isOpen:e,hasNodes:t,onClick:n})=>t?a("div",{className:"toggle-icon",onClick:n,children:a(Ge,{"aria-label":"Toggle",classname:w("symbol",{open:e})})}):null,Ve=e=>{const _=e,{active:t,onClick:n,toggleNode:o}=_,s=M(_,["active","onClick","toggleNode"]),{hasNodes:i,isOpen:u,label:r,level:l}=s,c={className:w(`tree-item tree-item-level${l}`,{"tree-item--active":t}),style:{paddingLeft:`${(i?0:3)+l*1.75}rem`},onClick:v=>{n(v)}},f={isOpen:u,hasNodes:i,onClick:v=>{v.stopPropagation(),i&&o&&o()}};return m("li",b(d({},c),{role:"button","aria-pressed":t,children:[a(ze,d({},f)),a("div",{className:"tree-item-content",children:a("span",{onClick:v=>v.stopPropagation(),children:r})})]}))},qe=e=>a("div",{className:"tree-container",children:a(ae,{data:e.nodes,children:({items:t})=>a("ul",{className:"tree-item-group",children:t.map(s=>{var i=s,{key:n}=i,o=M(i,["key"]);return a(Ve,d({},o),n)})})})}),Ke=()=>{const e=y(t=>t.mods.fileList);return a("div",{className:"files-tab__file-list",children:a(qe,{nodes:e})})},X={files:"File List",overwrite:"Overrides",overwritten:"Overridden By",meta:"Metadata"},Ue=Object.keys(X);function We(){const[e,t]=h.exports.useState("files"),n=h.exports.useCallback(s=>{e!==s&&t(s)},[e]),o=h.exports.useCallback(s=>({onClick:()=>n(s),className:e===s?"tab-active":void 0}),[n,e]);return m("div",{className:"mod-info",children:[a("div",{className:"mod-info__tabs-container",children:Ue.map(s=>a("div",b(d({},o(s)),{children:X[s]}),"tab-"+s))}),a("div",{className:"mod-info__content",children:O.match(e).with("files",()=>a(Ke,{})).with(O.__,()=>"Sorry, but this tab isn't implemented yet").exhaustive()})]})}const Je=({innerRef:e,draggableProps:t,dragHandleProps:n})=>d(d({ref:e},t),n);function Qe(){const e=T(),t=y(i=>i.mods.list),n=y(i=>i.mods.loading),o=y(i=>i.mods.loadErr),s=y(i=>i.mods.selected);return a(q.Fragment,{children:n||o?a("div",{children:o?`Error: ${o}`:"Loading..."}):t.map(({id:i,content:u},r)=>{const l=s===i;return a(oe,{draggableId:i,index:r,children:(c,f)=>a("div",b(d({},Je(c)),{id:i,tabIndex:1,onDoubleClick:()=>e(Ce(i)),className:w("modCard",{selected:l}),style:be(f,c.draggableProps.style),children:u}))},i)})})}const Xe=()=>{const e=T();return h.exports.useEffect(()=>{g||(console.info("Tauri context not detected!"),console.info("Dummy data will be used, which locks off some functionality!")),e(W())},[]),m("div",{className:"root__grid",children:[a(se,{onDragEnd:t=>e(Te(t)),children:a(ie,{droppableId:"modList",children:(t,n)=>m("div",b(d({},t.droppableProps),{ref:t.innerRef,className:w("soft-corners bg-base-200 flex-vert justify-start h-full min-h-max overflow-y-auto",{"outline outline-2 outline-accent":n.isDraggingOver}),children:[a(Qe,{}),t.placeholder]}))})}),m("div",{className:"info-pane",children:[a(We,{}),a(He,{})]})]})},Ye=re({reducer:{mods:ve,settings:Se}});le.render(a(h.exports.StrictMode,{children:a(ce,{store:Ye,children:a(Xe,{})})}),document.getElementById("root"));
